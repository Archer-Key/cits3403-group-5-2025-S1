{% extends "base.html" %}

{% block title %}Change Email{% endblock %}

{% block content %}
<div class="page-content container-fluid">
    <div class="row justify-content-center mt-3">
        <div class = "card w-100" style ="max-width: 800px; max-height: 800px ; margin: 20px;">
            <h3 class="text-center">My Email</h3>
            <form action="{{ url_for('change_email') }}" method="POST">
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Save Changes</button>
                <a href="{{ url_for('account_settings') }}" class="btn btn-secondary w-100 mt-2">Cancel</a>
            </form>
            <script>
                document.getElementById('email').addEventListener('input', function () {
                    const email = this.value;
                    fetch('{{ url_for("validate_user") }}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: email })
                    })
                    .then(response => response.json())
                    .then(data => {
                        const feedback = document.getElementById('email-feedback');
                        feedback.textContent = data.email;
                        feedback.style.color = data.email === "Email is available." ? "green" : "red";
                    });
                });
            </script>
        </div>
{% endblock %}