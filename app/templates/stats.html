{% extends "base.html" %}

{% block content %}
<div class="page-content container-fluid">
  <div class="row justify-content-center">
    <div class="col col-lg-9 col-xxl-6">
      <h2 class="mt-4 mb-4 text-center">ðŸŽµ Your Music Stats</h2>
      <div class="d-flex flex-column gap-4">
        <!-- ITEM SECTION -->
        {% for title, section in [("Tracks", analysis["tracks"]), ("Albums", analysis["albums"]), ("Artists", analysis["artists"])] %}
        <!-- TOP ITEMS COMPARISON -->
        <div class="comparison shadow-sm">
          <h2 class="comparison-title">Top {{ title }} Comparison</h2>
          
          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Your Pick</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['db_top'].type }} col">
              <img class="item-img" src="{{ section['db_top'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['db_top'].title }}</p>
                {% if section['db_top'].type != 'artist' %}
                <p class="item-creator">{{ section['db_top'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>
                    
          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Spotify Says</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['api_top'].type }} col">
              <img class="item-img" src="{{ section['api_top'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['api_top'].title }}</p>
                {% if section['api_top'].type != 'artist' %}
                <p class="item-creator">{{ section['api_top'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>
          
          <div class="comparison-result col-12">
            {% if section['db_top'].id == section['api_top'].id %}
              <span class="comparison-badge badge bg-success"><i class="bi bi-check-circle"></i> Perfect Match!</span>
            {% else %}                                                                                                             
              <span class="comparison-badge badge bg-danger"><i class="bi bi-x-circle"></i> No Match</span>                       
            {% endif %}                                                                                                            
          </div>

        </div>

        <!-- EXTREMES SECTION -->
        {% if section['high_high'] != None %}

        <div class="comparison shadow-sm">
          <h2 class="comparison-title">Overrated, Underrated, and Perfectly Rated</h2>
            
          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Highest Rated Most Listened</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['high_high'].type }} col">
              <img class="item-img" src="{{ section['high_high'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['high_high'].title }}</p>
                {% if section['high_high'].type != 'artist' %}
                <p class="item-creator">{{ section['high_high'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>
          
          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Highest Rated Least Listened</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['high_low'].type }} col">
              <img class="item-img" src="{{ section['high_low'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['high_low'].title }}</p>
                {% if section['high_low'].type != 'artist' %}
                <p class="item-creator">{{ section['high_low'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        
          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Lowest Rated Most Listened</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['low_high'].type }} col">
              <img class="item-img" src="{{ section['low_high'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['low_high'].title }}</p>
                {% if section['low_high'].type != 'artist' %}
                <p class="item-creator">{{ section['low_high'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Lowest Rated Least Listened</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['low_low'].type }} col">
              <img class="item-img" src="{{ section['low_low'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['low_low'].title }}</p>
                {% if section['low_low'].type != 'artist' %}
                <p class="item-creator">{{ section['low_low'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="comparison-item">
            <div class="comparison-subtitle col-3">
              <p>Biggest Outlier</p>
            </div>
            <div class="item item-lg item-borderless item-type-{{ section['outlier'].type }} col">
              <img class="item-img" src="{{ section['outlier'].img_url }}" alt="">
              <div class="item-desc">
                <p class="item-title">{{ section['outlier'].title }}</p>
                {% if section['outlier'].type != 'artist' %}
                <p class="item-creator">{{ section['outlier'].creator }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <p>Not enough data to find outliers...</p>
        {% endif %}
        
        {% endfor %}
        
        <!-- GRAPH SECTION -->
        {% for graph in analysis['graphs'][0:4] %} <!-- Genres doesn't look good so removed for now -->
        <div class="comparison shadow-sm">
          <h2 class="comparison-title">{{ graph.title }}</h2>
          <div class="bar-graph">
            {% for label, data, min, max in graph.data %}
            <div class="bar-graph-group">
              <div class="bar-graph-label col-1">{{ label }}</div>
              <div class="bar-graph-bar-container col">
                <div class="bar-graph-bar" style="width:{{100*data/max}}%;"></div> <!-- Ignore what VS Code says, this line is fine-->
              </div>
              <div class="bar-graph-data col-1">{{ data }}</div>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}